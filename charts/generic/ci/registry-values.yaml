# CI Test: Custom Registry Injection
# Tests the image.registry field which overrides or prepends custom registries

enabled: true

# Test custom registry injection
image:
  registry: "my-registry.example.com"
  repository: "docker.io/library/nginx"  # Should strip docker.io and use my-registry.example.com
  tag: "1.25"
  pullPolicy: IfNotPresent

replicas: 1

ports:
  - name: http
    containerPort: 80
    protocol: TCP

service:
  enabled: true
  type: ClusterIP
  ports:
    - name: http
      port: 80
      targetPort: http
      protocol: TCP

# Test extra deployment with different registry handling
extraDeployments:
  worker:
    enabled: true
    replicas: 2
    image:
      registry: "private-registry.example.com"
      repository: "myapp/worker"  # Simple name, should prepend registry
      tag: "2.0"
    ports:
      - name: metrics
        containerPort: 9090
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi

  sidecar:
    enabled: true
    replicas: 1
    image:
      # No registry override - should use repository as-is
      repository: "gcr.io/my-project/sidecar"
      tag: "latest"
    ports:
      - name: http
        containerPort: 8080

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Health checks
livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
