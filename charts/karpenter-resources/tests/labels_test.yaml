suite: test labels and naming
templates:
  - ec2nodeclass.yaml
  - nodepool.yaml
tests:
  - it: should use correct labels on all resources
    templates:
      - ec2nodeclass.yaml
      - nodepool.yaml
    set:
      nodePools:
        default:
          enabled: true
          nodeClassRef:
            group: karpenter.k8s.aws
            kind: EC2NodeClass
            name: default
      ec2NodeClasses:
        default:
          enabled: true
    asserts:
      - isSubset:
          path: metadata.labels
          content:
            helm.sh/chart: karpenter-resources-0.4.0
            app.kubernetes.io/name: karpenter-resources
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/managed-by: Helm

  - it: should override name with nameOverride
    templates:
      - ec2nodeclass.yaml
    set:
      nameOverride: custom-name
      ec2NodeClasses:
        default:
          enabled: true
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: custom-name

  - it: should override full name with fullnameOverride
    templates:
      - ec2nodeclass.yaml
    set:
      fullnameOverride: custom-full-name
      ec2NodeClasses:
        default:
          enabled: true
    asserts:
      - matchRegex:
          path: metadata.labels["app.kubernetes.io/instance"]
          pattern: RELEASE-NAME

  - it: should add app version label
    templates:
      - ec2nodeclass.yaml
    set:
      ec2NodeClasses:
        default:
          enabled: true
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/version"]
          value: "1.3.3"
